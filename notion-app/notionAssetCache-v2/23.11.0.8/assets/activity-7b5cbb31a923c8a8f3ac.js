"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1471],{48298:(e,t,i)=>{i.d(t,{kn:()=>p,kj:()=>g,Tr:()=>m});var o=i(58129),r=i(75246),s=i(19889),n=i(50906),a=i(54642),d=i(76464),h=i(9953),l=i(30149),c=i(73076),u=i(98905);const p=async e=>{const{environment:t,store:i,accessRequestStore:o,forActor:r,status:a,from:c}=e,u=t.currentUser.id;if("approved"===a){const e={type:"existingUser",value:r,spaceRole:"read_and_write"};if(!(await d.n_({environment:t,store:i,inviteTargets:[e],inviteRole:"read_and_write",isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return}l.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{h.sW({store:o,transaction:e,data:{granted_time:Date.now(),granted_by_table:s.KJ,granted_by_id:u,resolved_time:Date.now(),resolved_by_table:s.KJ,resolved_by_id:u,status:a}})}}),n.trackResolveMembershipRequest(t,{status:a,request_id:o.id,from:c,for_actor_id:r.id,space_role:i.getRole()})};async function g(e){if(u.Z.reset(),!e.canAdmin)return;const{environment:t,spaceId:i}=e,o=await a.getUnreadAccessRequestCount(t,{parentTable:r.bx,parentId:i,size:1});"success"===o.type&&u.Z.setState({spaceId:i,count:o.data.count})}function m(e,t){const i=new Map;for(const r of t){const t=(0,c.Kv)(e,{table:o.J8,id:r}),n=t.getValue();if(!n)continue;if(n.for_actor_table!==s.KJ||n.created_by_table!==s.KJ)continue;const a=(0,c.Kv)(e,{table:n.for_actor_table,id:n.for_actor_id}).getValue();if(!a)continue;const d=(0,c.Kv)(e,{table:n.created_by_table,id:n.created_by_id}).getValue();if(d)if(i.has(n.for_actor_id)){const e=i.get(n.for_actor_id);if(!e)continue;n.created_time>e.latestRequestTime?i.set(n.for_actor_id,{...e,createdByActorsWithReason:[{actor:d,reason:n.message},...e.createdByActorsWithReason],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time}):i.set(n.for_actor_id,{...e,createdByActorsWithReason:[...e.createdByActorsWithReason,{actor:d,reason:n.message}]})}else i.set(n.for_actor_id,{forActor:a,createdByActorsWithReason:[{actor:d,reason:n.message}],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time})}return Array.from(i.values())}},23351:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Xe});var o=i(77094),r=i.n(o),s=i(96486),n=i.n(s),a=i(67294),d=i(83355),h=i(40902),l=i(66897),c=i(17215),u=i(41432),p=i(8848),g=i(39068),m=i(55061),v=i(98459),f=i(89101),b=i(58129),A=i(21202),S=i(77420),y=i(6287),k=i(13493),_=i(70279),T=i(33709),O=i(57883),M=i(84683),C=i(75246),w=i(29369),B=i(19889),R=i(94044),J=i(99108),D=i(70203),I=i(97880),N=i(82990),P=i(63143),x=i(5366),Z=i(50906),F=i(19719),L=i(17659),q=i(9953),U=i(4083),V=i(38363),E=i(30149),G=i(4708),K=i(14976),W=i(17731),z=i(33929),H=i(17652),$=i(98165),j=i(67669),Y=i(73076),Q=i(62820),X=i(4761),ee=i(97464),te=i.n(ee),ie=i(53397),oe=i(51118),re=i(43250),se=i(16402),ne=i(12318),ae=i(64921),de=i(73063),he=i(86176),le=i(58032),ce=i(70301),ue=i(25383),pe=i(67706),ge=i(480),me=i(24405);function ve(e){let{notification:t,rootStore:i}=e;const o=(0,ge.O7)(),s=(0,a.useCallback)((()=>{t&&E.createAndCommit({userAction:"InboxActionsMenu.handleArchive",environment:o,perform:e=>{L.aZ({notification:t,rootStore:i,transaction:e})}})}),[o,t,i]),n=(0,a.useCallback)((()=>{t&&E.createAndCommit({userAction:"InboxActionsMenu.toggleNotificationReadStatus",environment:o,perform:e=>{L.$h({notification:t,rootStore:i,transaction:e,read:!t.read})}})}),[o,t,i]),d=(0,me.y)((e=>({container:{display:"flex",height:"min-content",background:e.buttonGroupBackground,boxShadow:e.lightBoxShadow,borderRadius:4,padding:2},readIcon:{width:16,height:15,fill:e.mediumTextColor},unreadIcon:{width:18,height:18,fill:e.mediumTextColor},archiveIcon:{width:17,height:17,fill:e.mediumTextColor}})),[]);return t?r()("div",{style:d.container},void 0,r()(le.Z,{renderTooltip:()=>t.read?r()(x.FormattedMessage,{defaultMessage:"Mark this notification as unread",id:"inboxActionsMenu.markNotificationAsUnread.tooltipMessage",description:"Tooltip message for the icon button to mark a notification as unread. The icon is an image of an empty speech bubble."}):r()(x.FormattedMessage,{defaultMessage:"Mark this notification as read",id:"inboxActionsMenu.markNotificationAsRead.tooltipMessage",description:"Tooltip message for the icon button to mark a notification as read. The icon is an image of a speech bubble with a checkmark in it."}),render:e=>a.createElement(de.Z,te()({icon:t.read?ie.Z.notificationUnread:ie.Z.notificationRead,iconStyle:t.read?d.unreadIcon:d.readIcon,onClick:n},e))}),r()(le.Z,{renderTooltip:()=>r()(x.FormattedMessage,{defaultMessage:"Archive this notification",id:"inboxActionsMenu.handleArchive.tooltipMessage",description:"Tooltip message for the icon button to archive a notification. The icon is an image of a storage file box."}),render:e=>a.createElement(de.Z,te()({icon:ie.Z.archive,iconStyle:d.archiveIcon,onClick:s},e))})):null}const fe=a.memo(ve);var be=i(32469),Ae=i(93963);class Se extends d.Z{constructor(){super(...arguments),this.storeTypes={hovered:ne.default.of(!1),hoveredOverInboxActionsMenu:ne.default.of(!1)},this.handleMouseMove=()=>{this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{this.stores.hovered.set(!1)},this.handleMouseEnterInboxActions=()=>{this.stores.hoveredOverInboxActionsMenu.set(!0)},this.handleMouseLeaveInboxActions=()=>{this.stores.hoveredOverInboxActionsMenu.set(!1)},this.handleArchive=()=>{const{notification:e,rootStore:t,onArchiveClicked:i}=this.props;i(),e&&E.createAndCommit({userAction:"ActivitySection.handleArchive",environment:this.environment,perform:i=>{L.aZ({notification:e,rootStore:t,transaction:i})}})},this.handleMarkAsRead=()=>{const{notification:e,rootStore:t}=this.props;(0,H.sn)()&&e&&!e.read&&(this.stores.hoveredOverInboxActionsMenu.get()||E.createAndCommit({userAction:"ActivitySection.handleMarkAsRead",environment:this.environment,perform:i=>{L.$h({notification:e,rootStore:t,transaction:i,read:!0})}}))},this.handleOpenSnapshot=()=>{if(this.props.navigableBlockId){const e=Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:this.props.navigableBlockId});oe.jN({environment:this.environment,blockStore:e,openSnapshotNearTimestamp:this.props.timestamp.toString(),from:"activity"})}}}renderComponent(){const{children:e}=this.props;return r()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleMarkAsRead},void 0,r()("div",{style:{...Se.wrapStyle,paddingBottom:e?12:8,paddingLeft:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingLeftCSS:0,paddingRight:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingRightCSS:0,...this.shouldShowReadNotificationStyle()&&{color:this.theme.mediumTextColor,background:this.theme.accentColors.gray[30]}}},void 0,r()("div",{style:this.getHeaderAndAvatarStyle()},void 0,r()("div",{className:re.FoE,style:{...this.avatarAndStatusDotStyle(),...this.shouldShowReadNotificationStyle()&&{opacity:.5}}},void 0,(0,H.sn)()&&r()("div",{style:{marginRight:4}},void 0,this.renderStatusDot()),this.props.icon),this.renderHeader(),this.renderSnapshotButton(),(0,H.sn)()?this.renderInboxActions():this.renderArchiveAction(),this.renderPrivate()),e&&this.renderChildren()),this.renderDivider())}renderDivider(){const{isLast:e}=this.props;if(!e)return r()("div",{style:this.getBorderBottomStyle()})}renderHeader(){const{timestamp:e,header:t}=this.props,i=(0,se.IS)(e),o=(0,se.uy)(e);return r()("div",{style:Se.headerStyle},void 0,r()("div",{className:re.NFf},void 0,t),r()("div",{style:{display:"flex",marginTop:4,marginBottom:this.props.children?8:4}},void 0,r()("div",{style:this.getTimeStyle(),className:re.CZG},void 0,r()(pe.Z,{text:i,tooltipText:o,icon:ie.Z.calendar})),this.props.navigableBlockId&&this.props.rootStore&&r()(he.Z,{isLink:!0,innerStyle:this.getPathStyle(),store:Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:this.props.navigableBlockId}),left:r()("div",{style:this.getSeparatorDotStyle()},void 0,"Â·"),onClick:this.props.onBacklinkClicked})))}renderSnapshotButton(){if(this.props.showSnapshotButton&&!(this.props.timestamp<new Date("2018-10-26").getTime()))return this.props.navigableBlockId?r()(le.Z,{renderTooltip:()=>r()(x.FormattedMessage,{defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),render:e=>a.createElement(de.Z,te()({onClick:this.handleOpenSnapshot,icon:ie.Z.versionHistoryThick},e))}):void 0}renderInboxActions(){const{notification:e,rootStore:t}=this.props,{currentTab:i}=X.Z.state;if("mentions"===i&&e&&!e.visited)return r()("div",{style:this.getStatusLabelContainerStyle(),onMouseEnter:this.handleMouseEnterInboxActions,onMouseLeave:this.handleMouseLeaveInboxActions},void 0,!(0,H.sn)()&&this.renderStatusDot(),r()("div",{style:this.getInboxActionsStyle()},void 0,r()(fe,{notification:e,rootStore:t})))}renderStatusDot(){return!this.isSeen()&&r()(Ae.z,{style:{...this.getStatusDotStyle(),opacity:1}})}renderArchiveAction(){const{notification:e}=this.props,{device:t}=this.environment,{currentTab:i}=X.Z.state;if("mentions"===i&&e&&!e.visited)return r()(le.Z,{renderTooltip:()=>r()(x.FormattedMessage,{defaultMessage:"Archive this notification",id:"activitySection.archiveAction.tooltip"}),render:e=>a.createElement("div",te()({style:this.getStatusLabelContainerStyle()},e),!this.isSeen()&&r()(Ae.z,{style:this.getStatusDotStyle()}),r()(ae.Z,{onClick:this.handleArchive,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:this.theme.buttonHoveredBackground,width:t.isMobile?24:20,height:t.isMobile?24:20,opacity:this.environment.device.isMobile||this.stores.hovered.get()?1:0},hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,ie.Z.closeSmall({width:t.isMobile?18:14,fill:this.theme.mediumTextColor})))})}renderPrivate(){if(this.props.isPrivate&&!this.props.notification)return r()(be.Z,{style:{marginTop:1,marginBottom:4,marginLeft:8}})}renderChildren(){return r()("div",{className:re.nU_},void 0,this.props.children)}isSeen(){const{notification:e}=this.props;return!e||e.read}shouldShowReadNotificationStyle(){const{currentTab:e}=X.Z.state;return this.isSeen()&&"mentions"===e&&!this.props.showSnapshotButton&&(0,H.sn)()}avatarAndStatusDotStyle(){return{display:"flex",alignItems:"flex-start",position:"relative"}}getHeaderAndAvatarStyle(){return{display:"flex",paddingLeft:16,paddingRight:16}}getBorderBottomStyle(){return{borderBottom:`1px solid ${this.theme.regularDividerColor}`}}getPathStyle(){return{fontSize:12,color:this.theme.lightTextColor}}getTimeStyle(){return{fontSize:12,color:this.theme.lightTextColor,whiteSpace:"nowrap"}}getSeparatorDotStyle(){return{fontSize:12,color:this.theme.lightTextColor,marginLeft:4,marginRight:4}}getStatusLabelContainerStyle(){return{display:"flex",alignItems:"flex-start",marginTop:1,marginBottom:4,position:"relative",marginLeft:this.environment.device.isMobile?23:8}}getStatusDotStyle(){return(0,H.sn)()?{position:"absolute",opacity:this.stores.hovered.get()?0:1,left:this.environment.device.isMobile?-10:-8,top:(this.environment.device.isMobile,10)}:{marginRight:4,position:"absolute",opacity:this.stores.hovered.get()?0:1,right:this.environment.device.isMobile?28:2.5,top:this.environment.device.isMobile?7.5:5.5}}getInboxActionsStyle(){const{isMobile:e}=this.environment.device;return{transition:"opacity 100ms ease-out",opacity:e||this.stores.hovered.get()?1:0,...!e&&{position:"absolute",top:0,right:0,zIndex:1}}}}Se.wrapStyle={paddingTop:12},Se.headerStyle={fontSize:14,lineHeight:1.4,flexGrow:1,minWidth:0};const ye={fontWeight:N.Z.fontWeight.semibold},ke={marginTop:2,marginRight:8,flexShrink:0};function _e(e){const{authors:t}=e,i=t[0],o=(0,H.ME)()?24:28;return i&&(0,l.z8)(i)?r()(ce.Z,{botValue:i.value,style:ke,size:o}):r()(ue.Z,{userValue:i&&i.value,style:ke,size:o,avatarShouldShowShadow:!0})}function Te(){return r()("div",{style:{display:"flex",backgroundColor:p.ZP.red,height:28,width:28,borderRadius:"100%",...ke}},void 0,ie.Z.alarmClock({height:16,width:16,fill:p.ZP.white,marginLeft:6,marginTop:5}))}function Oe(e){const t=e.map((e=>(0,l.$4)(z.default.getIntl(),e)));if(1===t.length)return r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"<b>{author}</b>",id:"activitySection.authorPhrase.forOneAuthor.label",values:{author:t[0],b:e=>r()("span",{style:ye},void 0,e)}}));if(2===t.length)return r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"<b>{firstAuthor}</b> and <b>{secondAuthor}</b>",id:"activitySection.authorPhrase.forTwoAuthors.label",values:{firstAuthor:t[0],secondAuthor:t[1],b:e=>r()("span",{style:ye},void 0,e)}}));if(t.length>2){const e=r()(x.FormattedMessage,{defaultMessage:"{numberOfOtherAuthors, plural, one {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} other} other {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} others}}",id:"activitySection.authorPhrase.forMoreThanTwoAuthors.label",values:{numberOfOtherAuthors:t.length-2,firstAuthor:t[0],secondAuthor:t[1],b:e=>r()("span",{style:ye},void 0,e)}});return r()("span",{},void 0,e)}return r()("span",{style:ye},void 0,r()(x.FormattedMessage,{defaultMessage:"Nobody",id:"activitySection.authorPhrase.forNoAuthors.label"}))}const Me=Se;var Ce=i(48298),we=i(91376),Be=i(17256),Re=i(64404),Je=i(61519),De=i(62385),Ie=i(64369);class Ne extends d.Z{constructor(){super(...arguments),this.storeTypes={role:ne.default.of(void 0)}}renderComponent(){const e=this.props.accessRequestStore.getValue();if(e){if((0,b.ce)(e))return this.renderResolvedSpaceMembershipRequest(e);if(this.canResolveMembershipRequests())return r()("div",{style:{display:"flex",alignItems:"center"}},void 0,r()(De.Z,{onClick:()=>this.resolveMembershipRequest("approved"),style:this.getButtonStyle(!1)},void 0,r()(x.FormattedMessage,{defaultMessage:"Approve",id:"approveSpaceMembershipActivityAction.approveButton.label",description:"Button in notification to approve a membership request."})),r()(De.Z,{onClick:()=>this.resolveMembershipRequest("rejected"),style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(x.FormattedMessage,{defaultMessage:"Decline",id:"approveSpaceMembershipActivityAction.declineButton.label",description:"Decline space membership request button in notification."})),!this.environment.device.isMobile&&a.createElement(a.Fragment,null,r()(Je.Z,{size:1,vertical:!0,style:{height:26,paddingLeft:8,paddingRight:8}}),r()(De.Z,{onClick:()=>{Z.trackClickViewAllRequests(this.environment,{disable_membership_requests:this.props.spaceStore.getDisableMembershipRequests()}),this.handleOpenSettingsMembersRequests()},style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(x.FormattedMessage,{defaultMessage:"View all requests",id:"approveSpaceMembershipActivityAction.viewAllRequests.label",description:"Button that takes user to the settings modal members requests tab to see all existing requests."}))))}}renderResolvedSpaceMembershipRequest(e){const t=("approved"===e.status||"rejected"===e.status)&&this.renderActor(e.resolved_by_table,e.resolved_by_id),i=(0,Be.Z)(Math.min(e.resolved_time,Date.now())).calendar();return a.createElement(a.Fragment,null,r()(Ie.Z,{isSecondaryColor:!0},void 0,"approved"===e.status?r()(x.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"approveSpaceMembershipActivityAction.requestApproved.title",values:{grantedBy:t,time:i},description:"Message showing that space membership request has been approved."}):r()(x.FormattedMessage,{defaultMessage:"Declined by {grantedBy}",id:"approveSpaceMembershipActivityAction.requestDeclined.title",values:{grantedBy:t,time:i},description:"Message showing that space membership request has been declined."})),r()(Ie.Z,{isSmall:!0,isSecondaryColor:!0},void 0,i))}handleOpenSettingsMembersRequests(){(0,we.r)({currentTab:"members",subtab:Re.Q.Requests})}canResolveMembershipRequests(){return this.props.spaceStore.canEditMembership()}renderActor(e,t){return Oe(n().compact([this.getActor(e,t)]))}getActor(e,t){if(e===B.KJ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.dp)(i)}if(e===S.cZ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.D$)(i)}}get rootStore(){return this.props.accessRequestStore}async resolveMembershipRequest(e){if(!this.canResolveMembershipRequests())return;const t=this.environment,{spaceStore:i,accessRequestStore:o}=this.props,r=o.getValue();if(!r)return;const s=this.getActor(B.KJ,r.for_actor_id);s&&s.table===B.KJ&&await(0,Ce.kn)({environment:t,store:i,accessRequestStore:o,forActor:s.value,status:e,from:"notification"})}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}}const Pe=Ne;var xe=i(1136),Ze=i(45669),Fe=i(84076),Le=i(31278),qe=i(76798),Ue=i(79931),Ve=i(27006),Ee=i(76464),Ge=i(21115),Ke=i(78291),We=i(7567);class ze extends d.Z{constructor(){super(...arguments),this.storeTypes={role:ne.default.of(void 0)},this.handleApproveMembershipRequest=async()=>{},this.handleGrantPageAccess=async()=>{const{targetBlockStore:e,accessRequestStore:t}=this.props,i=this.getInviteTargetWithNewPermissionItem();if(!("permissionItem"in i))return;const o=this.environment.currentUser.id;if(!o)return;if("type"in i){let t;if("existingUser"===i.type){t=(await Ee.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:i.permissionItem.role,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else if("bot"===i.type){t=(await Ee.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:void 0,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else(0,I.t1)(i);if(!t)return}E.createAndCommit({userAction:"GrantPageAccessActivityAction.handleGrantPageAccess",environment:this.environment,perform:r=>{"type"in i||Ee.ep({environment:this.environment,transaction:r,store:e,permissionItems:[i.permissionItem]}),q.sW({store:t,transaction:r,data:{granted_time:Date.now(),granted_by_table:B.KJ,granted_by_id:o,resolved_time:Date.now(),resolved_by_table:B.KJ,resolved_by_id:o,status:"approved"}})}});const r=t.getValue(),s=r&&r.created_time&&r.granted_time?r.granted_time-r.created_time:void 0;Z.trackGrantAccess(this.environment,{requestId:r&&r.id,timeElapsedSinceRequest:s,newAccessLevel:i.permissionItem.role,...this.getGrantOrIgnoreAccessArgs()})},this.handleRoleChange=e=>{const t=this.props.accessRequestStore.id,i=this.stores.role.state;this.stores.role.setState(e),Z.trackChangeGrantAccessLevel(this.environment,{requestId:t,previousAccessLevel:i,newAccessLevel:e,...this.getGrantOrIgnoreAccessArgs()})},this.handleArchive=()=>{const{notification:e}=this.props;e&&(E.createAndCommit({userAction:"GrantPageAccessActivityAction.handleArchive",environment:this.environment,perform:t=>{(0,L.aZ)({notification:e,rootStore:this.props.accessRequestStore,transaction:t})}}),Z.trackIgnoreAccessRequest(this.environment,this.getGrantOrIgnoreAccessArgs()))}}renderComponent(){const e=this.props.accessRequestStore.getValue();if(!e)return;if((0,b.Kc)(e))return this.renderGrantedAccessRequest(e);if(!this.canGrantAccess())return;const t=e.parent_table===C.bx,i=this.getCurrentPermissionItem();if(i&&!t){const t=this.renderActor(e.for_actor_table,e.for_actor_id),o=i.role===this.getRole();return a.createElement(a.Fragment,null,r()(Ie.Z,{isSecondaryColor:!0,style:{marginBottom:6}},void 0,r()(x.FormattedMessage,{defaultMessage:"{requestingUser} already has access.",id:"grantPageAccessActivityAction.alreadyHasAccess.label",description:"Shown if the user who requested access already has access",values:{requestingUser:t}})),r()(We.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:A.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===B.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!0)}),r()(De.Z,{onClick:this.handleGrantPageAccess,style:this.getButtonStyle(o)},void 0,r()(x.FormattedMessage,{defaultMessage:"Change",id:"grantPageAccessActivityAction.changePermissionButton.label",description:"Change permission button for page access requests in notification."})),this.renderArchiveButton())}return a.createElement(a.Fragment,null,r()(We.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:A.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===B.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!1)}),r()(De.Z,{onClick:this.handleGrantPageAccess,style:this.getButtonStyle(!1)},void 0,r()(x.FormattedMessage,{defaultMessage:"Grant access",id:"grantPageAccessActivityAction.grantAccessButton.label",description:"Button in notification to grant access to a page access request."})),this.renderArchiveButton())}renderGrantedAccessRequest(e){const t=this.renderActor(e.granted_by_table,e.granted_by_id),i=(0,Be.Z)(Math.min(e.granted_time,Date.now())).calendar();return a.createElement(a.Fragment,null,r()(Ie.Z,{isSecondaryColor:!0},void 0,r()(x.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"grantPageAccessActivityAction.accessGranted.title",description:"Approval message for page access requests in notification.",values:{grantedBy:t,time:i}})),r()(Ie.Z,{isSmall:!0,isSecondaryColor:!0},void 0,i))}renderArchiveButton(){const{notification:e}=this.props;if(e&&!e.visited)return r()(De.Z,{onClick:this.handleArchive,style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(x.FormattedMessage,{defaultMessage:"Ignore",id:"grantPageAccessActivityAction.ignoreButton.label",description:"Ignore page access request button in notification."}))}getRole(){const e=this.getCurrentPermissionItem(),t=e&&e.role;return this.stores.role.state||t||this.props.initialRole}getNewPermissionItem(){const e=this.props.accessRequestStore.getValue();if(e)return e.for_actor_table===B.KJ?{type:"user_permission",user_id:e.for_actor_id,role:this.getRole()}:{type:"bot_permission",bot_id:e.for_actor_id,role:this.getRole()}}getInviteTargetWithNewPermissionItem(){const e=this.getNewPermissionItem();if(!e)return{};if(this.getCurrentPermissionItem())return{permissionItem:e};const{data:t}=Ke.default.state;if("user_permission"===e.type){const i=this.rootStore.getRecordValue({table:B.KJ,id:e.user_id}),o=t?Ge.CM(t):[],r=o&&o.some((t=>t.userId===e.user_id));return i&&!r?{type:"existingUser",value:i,permissionItem:e}:{permissionItem:e}}if("bot_permission"===e.type){const i=this.rootStore.getRecordValue({table:S.cZ,id:e.bot_id}),o=(t?Ge.NM(t):[]).some((t=>t.botId===e.bot_id));return i&&!o?{type:"bot",value:i,permissionItem:e}:{permissionItem:e}}(0,I.t1)(e)}getCurrentPermissionItem(){const e=this.props.accessRequestStore.getValue();if(!e)return;const t=this.props.targetBlockStore.getPermissionItems();for(const i of t){if(e.for_actor_table===B.KJ&&(0,Ve.jg)(i)&&i.user_id===e.for_actor_id)return i;if(e.for_actor_table===S.cZ&&(0,Ve.FB)(i)&&i.bot_id===e.for_actor_id)return i}}canGrantAccess(){return this.props.targetBlockStore.canAdmin()}renderActor(e,t){return Oe(n().compact([this.getActor(e,t)]))}getActor(e,t){if(e===B.KJ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.dp)(i)}if(e===S.cZ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.D$)(i)}}get rootStore(){return this.props.accessRequestStore}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}getGrantOrIgnoreAccessArgs(){const{notification:e}=this.props;return{tab:(0,F.Jn)(),activityId:null==e?void 0:e.activity_id,notificationId:null==e?void 0:e.id}}}const He=ze;class $e extends d.Z{constructor(){super(...arguments),this.storeTypes={open:ne.default.of(!1)},this.handleOpen=()=>{this.stores.open.set(!0)}}renderComponent(){return this.stores.open.get()||this.props.items.length<=this.props.visible?r()("div",{},void 0,this.props.items):r()("div",{},void 0,this.props.items.slice(0,this.props.visible),r()(ae.Z,{onClick:this.handleOpen,style:this.getStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"View {moreCount} more",id:"activity.viewMoreButton.label",values:{moreCount:this.props.items.length-this.props.visible}})))}getStyle(){return{display:"flex",alignItems:"center",height:28,fontSize:12,color:this.theme.lightTextColor,padding:0,paddingLeft:52,paddingRight:16}}}const je=$e,Ye=r()("div",{style:{width:5,display:"inline-block"}});class Qe extends d.Z{constructor(e){super(e),this.renderBlockEdit=(e,t,i)=>{let o=this.getRecordValue({table:A.iU,id:e.block_id});o&&o.type===u.ZP.tableRow&&(o=this.getRecordValue({table:A.iU,id:o.parent_id}));const s=o?(0,c.Om)({table:"block",value:o,getRecordValue:this.getRecordValue}):f._j.root;return"block-deleted"===e.type?e.block_data.block_value.type===u.ZP.page?r()(Fe.Z,{href:s,onClick:()=>this.track("block_edit"),innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore})):r()("div",{style:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore})):r()(Fe.Z,{href:s,onClick:()=>this.track("block_edit"),innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))},this.renderCollectionPropertyEdit=(e,t)=>{if("collection-property-changed"===e.type)return r()(Fe.Z,{href:t,innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))},this.handleUnfollow=()=>this.handleFollowChanged(!1),this.handleFollow=()=>this.handleFollowChanged(!0),this.handleUnarchive=()=>{const{notification:e,rootStore:t}=this.props;e&&(E.createAndCommit({userAction:"Activity.handleUnarchive",environment:this.environment,perform:i=>{L.E1({notificationId:e.id,visited:!1,rootStore:t,transaction:i})}}),(0,F.F5)(this.getBaseNotificationArgs()))},this.getRecordStore=e=>this.props.rootStore.getRecordStore(this.props.rootStore,e),this.getUserValue=e=>Y.U6.createChildStore(this.props.rootStore,{table:B.KJ,id:e}).getValue(),this.getBotValue=e=>(0,Y.Kv)(this.props.rootStore,{table:S.cZ,id:e}).getValue(),this.getAuthorActor=e=>{if(e.table===B.KJ){const t=this.getUserValue(e.id);if(t)return(0,l.dp)(t)}else{const t=this.getBotValue(e.id);if(t)return(0,l.D$)(t)}},this.getSpaceStore=e=>Y.H2.createChildStore(this.props.rootStore,{table:C.bx,id:e}),this.getTeamStore=e=>Y.zX.createChildStore(this.props.rootStore,{table:w.e0,id:e}),this.getDiscussionLocation=e=>{let{forReplyMenu:t}=e;const{source:i}=this.props;if("updates_sidebar"===i)return t?"reply_menu_updates_sidebar":"updates_sidebar";return`${t?"reply_menu_":"updates_menu_"}${(0,F.Jn)()}`},this.getDiscussionContextAndId=()=>{const{activity:e}=this.props;if("commented"!==e.type)return;const t=this.getRecordValue({table:T.qF,id:e.discussion_id,spaceId:e.space_id});if(!t)return;if(!t.context)return;const i=(0,D.VP)(t.context,(e=>!(0,D.xw)(e)||(0,D.h1)(e)===t.id));return{id:t.id,context:i}},this.getDiscussionContext=()=>{const e=this.getDiscussionContextAndId();if(e)return e.context},this.handleTrackBacklinkClick=this.handleTrackBacklinkClick.bind(this),this.handleTrackArchiveClicked=this.handleTrackArchiveClicked.bind(this)}willMountOrUpdate(){this.warmCommentData(),this.environment.KatexStore.loadIfNeeded(this.getDiscussionContext)}warmCommentData(){if("commented"===this.props.activity.type){const e=this.getRecordStore({table:T.qF,id:this.props.activity.discussion_id,spaceId:this.props.activity.space_id});if(e.isDefined()){const t=e.getCommentStores();for(const e of t)if(e.isDefined()&&e.getCreatedByTable()&&e.getCreatedById()){this.getRecordStore(e.getCreatedByPointer()).load()}}}}renderComponent(){const{activity:e}=this.props;switch(e.type){case"block-edited":return this.renderBlockEditActivity(e);case"collection-row-created":case"collection-row-deleted":return this.renderCollectionRowActivity(e);case"top-level-block-created":case"top-level-block-deleted":return this.renderTopLevelBlockActivity(e);case"permissions-edited":return this.renderPermissionsActivity(e);case"permission-group-edited":return this.renderPermissionGroupActivity(e);case"user-mentioned":return this.renderMentionActivity(e);case"commented":return this.renderCommentActivity(e);case"user-invited":return this.renderUserInvitedActivity(e);case"collection-edited":return this.renderCollectionEdited(e);case"collection-view-edited":return this.renderCollectionViewEdited(e);case"collection-property-edited":return this.renderCollectionPropertyEdited(e);case"reminder":return this.renderReminderActivity(e);case"page-locked":case"page-unlocked":return this.renderPageLockActivity(e);case"email-edited":return this.renderEmailEdited(e);case"access-requested":return this.renderAccessRequested(e);case"page-deleted":case"page-restored":case"page-permanently-deleted":return this.renderPageDeleteOrRestoreActivity(e);case"team-membership-edited":return this.renderTeamMembershipEditedActivity(e);case"private-content-transferred":return this.renderPrivateContentTransferredActivity(e);default:(0,I.t1)(e)}}renderBlockEditActivity(e){if(!e.edits)return;const t=(0,J.hI)(e.edits).filter((e=>{const{block_value:t}="block-changed"===e.type?e.block_data.after:e.block_data;return t.parent_table!==_.x_}));if(0===t.length)return;const i=this.getBlockStore(t[0].navigable_block_id);if(!i.isDefined())return;const o=this.getAuthors(t),s=Oe(o),n=this.renderTitle("block",i);return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {pageTitle}} other {{authorOrAuthors} edited {pageTitle}}}",id:"activity.blockEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:n}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(_e,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(je,{visible:5,items:t.map(this.renderBlockEdit)}),this.renderNotificationActions())}renderCollectionRowActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(e.collection_row_id);if(!i.isDefined())return;if(!i.getProperties())return;const o=this.getAuthors(e.edits),s=Oe(o),n=this.renderTitle("block",i),a="collection-row-created"===t.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {pageTitle}} other {{authorOrAuthors} created {pageTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:n},id:"activity.collectionRowCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {pageTitle}} other {{authorOrAuthors} deleted {pageTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:n},id:"activity.collectionRowDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,a),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(_e,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderTopLevelBlockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(e.top_level_block_id);if(!i.isDefined())return;const o=i.hasSpacePermission(),s=this.getAuthors(e.edits),n=Oe(s),a=this.renderTitle("block",i);let d;return d=o?"top-level-block-created"===t.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created workspace page {pageTitle}} other {{authorOrAuthors} created workspace page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:a},id:"activity.topLevelBlockWorkspaceCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted workspace page {pageTitle}} other {{authorOrAuthors} deleted workspace page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:a},id:"activity.topLevelBlockWorkspaceDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"top-level-block-created"===t.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created private page {pageTitle}} other {{authorOrAuthors} created private page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:a},id:"activity.topLevelBlockPrivateCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted private page {pageTitle}} other {{authorOrAuthors} deleted private page {pageTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageTitle:a},id:"activity.topLevelBlockPrivateDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:s}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderPermissionsActivity(e){if(!e.edits)return;const t=(0,J.hI)(e.edits);if(0===t.length)return;let i,o;const s=t[0];if(s.navigable_block_id){const e=this.getBlockStore(s.navigable_block_id);if(!e.isDefined())return;o=this.renderTitle("block",e),i=this.getIsRecordPrivateToUser(e.id,"block")}else{const e=this.getSpaceStore(s.space_id);if(!e.isDefined())return;o=this.renderTitle("space",e),i=this.getIsRecordPrivateToUser(s.space_id,"space")}const{autojoinEdits:n,inheritanceEdits:a,otherEdits:d}=h.md(e.edits),l=[];n.forEach(((e,t)=>{const s=this.getAuthors([e]),n=Oe(s);l.push(r()(Me,{timestamp:e.timestamp,header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} joined {pageOrSpaceName}} other {{authorOrAuthors} joined {pageOrSpaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,pageOrSpaceName:o},id:"activity.permissionsActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:s}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},`autojoin-${t}`))})),a.forEach(((t,s)=>{const n=this.getAuthors([t]),a=Oe(n);let d;"permission-restriction-created"===t.type?d=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restricted access for {pageOrSpaceName}} other {{authorOrAuthors} restricted access for {pageOrSpaceName}}}{inSudoMode, select, true { using administrator privileges} other {}}",values:{numberOfAuthors:n.length,authorOrAuthors:a,pageOrSpaceName:o,inSudoMode:t.inSudoMode},id:"activity.restrictPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-restriction-deleted"===t.type&&(d=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored inherited access for {pageOrSpaceName}} other {{authorOrAuthors} restored inherited access for {pageOrSpaceName}}}{inSudoMode, select, true { using administrator privileges} other {}}",values:{numberOfAuthors:n.length,authorOrAuthors:a,pageOrSpaceName:o,inSudoMode:t.inSudoMode},id:"activity.restorePermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),l.push(r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:t.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:n}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},`inheritance-${s}`,r()("div",{style:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions()))}));const c=(t,o,n)=>{if(t.length>0){const a=this.getAuthors(t);l.push(r()(Me,{timestamp:parseInt(e.end_time),header:n,isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:s.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},o,t.map(((e,t,i)=>r()("div",{style:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore},t)))),this.renderNotificationActions()))}},u=d.filter((e=>!e.inSudoMode));if(u.length>0){const e=this.getAuthors(u),t=Oe(e);c(u,"other",r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} updated permission for {pageOrSpaceName}} other {{authorOrAuthors} updated permission for {pageOrSpaceName}}}",values:{numberOfAuthors:e.length,authorOrAuthors:t,pageOrSpaceName:o},id:"activity.updatedPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})))}const p=d.filter((e=>e.inSudoMode));if(p.length>0){const e=this.getAuthors(p),t=Oe(e);c(p,"other-sudo",r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} updated permission for {pageOrSpaceName}} other {{authorOrAuthors} updated permission for {pageOrSpaceName}}} using administrator privileges",values:{numberOfAuthors:e.length,authorOrAuthors:t,pageOrSpaceName:o},id:"activity.updatedPermissionsForActivityInSudoMode.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})))}return l}renderPermissionGroupActivity(e){if(!e.edits)return;const t=(0,J.hI)(e.edits)[0];if(!t)return;const i=this.getSpaceStore(t.space_id);if(!i.isDefined())return;const o=(0,c.Om)({table:"space",model:i.getModel(),getRecordModel:this.getRecordModel}),s=this.renderPermissionGroupTitle((0,m.c_)({activity:e,getRecordValue:this.getRecordValue}),e.space_id),n=this.getAuthors(e.edits);return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,this.renderPermissionGroupEditedHeader({activity:e,authors:n,groupName:s})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.space_id,"space"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:n}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:o,onClick:()=>this.track("group_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderMentionActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(t.navigable_block_id);if(!i.isDefined())return;const o=this.getBlockStore(e.mentioned_block_id);if(!o.isDefined())return;const s=(0,c.Om)({table:"block",model:o.getModel(),getRecordModel:this.getRecordModel}),n=this.getAuthors(e.edits),a=Oe(n);return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} mentioned you in {pageName}} other {{authorOrAuthors} mentioned you in {pageName}}}",values:{numberOfAuthors:n.length,authorOrAuthors:a,pageName:this.renderTitle("block",i)},id:"activity.mentionActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(_e,{authors:n}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:s,onClick:()=>this.track("mention_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderCommentActivity(e){if(!e.edits)return;let t=e.edits.filter((e=>{switch(e.type){case"comment-changed":return!(0,H.qe)();case"comment-created":case"comment-deleted":return!0;default:(0,I.t1)(e)}}));if(0===t.length&&0!==e.edits.length&&"updates_sidebar"!==this.props.source&&(t=e.edits),0===t.length)return;const i=this.getRecordStore({table:T.qF,id:e.discussion_id,spaceId:e.space_id});if(!i.isDefined())return;const o=Y.G.createChildStore(this.props.rootStore,i.getParentPointer()),s=(0,$.qA)(o),n=(0,$.fl)(s);if(!o.isDefined())return;const a=this.getBlockStore(e.navigable_block_id);if(!a.isDefined())return;const d=n?(0,c.Om)({table:"block",model:o.getModel(),getRecordModel:this.getRecordModel,discussionId:e.discussion_id}):void 0,h=this.getAuthors(t),l=Oe(h),u=t=>{if(this.track("comment_edit"),!n){var r;const s=t.target;(0,U.oK)({environment:this.environment,discussionStore:i,rect:s.getBoundingClientRect(),blockStore:o,discussionLocation:this.getDiscussionLocation({forReplyMenu:!0}),activityId:e.id,notificationId:null===(r=this.props.notification)||void 0===r?void 0:r.id})}};return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented in {blockName}} other {{authorOrAuthors} commented in {blockName}}}",values:{numberOfAuthors:h.length,authorOrAuthors:l,blockName:this.renderTitle("block",a)},id:"activity.commentActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.navigable_block_id,"block"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:h}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderCommentContext({activity:e,url:d,onClick:u}),r()(je,{visible:5,items:t.map(((e,t,i)=>r()(Fe.Z,{onClick:u,href:d,innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore,type:"comment-edit",discussionLocation:this.getDiscussionLocation({forReplyMenu:!1})}))))}),this.renderCommentActions(e,n))}renderCommentContext(e){const{url:t,onClick:i}=e,o=this.getDiscussionContextAndId();if(!o)return;const{id:s,context:n}=o,a=0===(0,D.ll)(n).length,d=(0,K.IY)({environment:this.environment,textValue:{value:n,spaceId:this.props.activity.space_id},parentStore:this.props.rootStore,disableHover:!0,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,highlightDiscussionId:s,theme:this.theme,emojiType:(0,W.e)(this.environment),katex:this.environment.KatexStore.getKatex(),enableEndOfLineMarker:!1,formulaValueTypes:[]});return r()(Fe.Z,{href:t,onClick:i,innerStyle:{...Qe.editButtonStyle,display:"flex",alignItems:"flex-start",fontSize:14,...a&&{color:this.theme.mediumTextColor},paddingTop:2,paddingBottom:6,marginBottom:0}},void 0,a&&r()("div",{style:{flexShrink:0,alignSelf:"center",width:3,borderRadius:3,marginLeft:2,marginRight:8,height:20,background:p.DB}}),r()("div",{style:{...N.Z.textOverflowStyle}},void 0,d))}renderCommentActions(e,t){const i=this.getRecordValue({table:T.qF,id:e.discussion_id,spaceId:e.space_id});if(!i)return;const o=(0,Y.Kv)(this.props.rootStore,{table:T.qF,id:i.id,spaceId:(0,v.CG)(this.props.rootStore.pointer.spaceId)}),s=Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:i.parent_id});return r()("div",{style:{paddingLeft:52,paddingTop:12,paddingBottom:4}},void 0,r()(De.Z,{onClick:t=>{var i;const r=t.target;(0,U.oK)({environment:this.environment,discussionStore:o,rect:r.getBoundingClientRect(),blockStore:s,discussionLocation:this.getDiscussionLocation({forReplyMenu:!0}),activityId:e.id,notificationId:null===(i=this.props.notification)||void 0===i?void 0:i.id})},style:this.getActionButtonStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"Reply",id:"activity.replyButton.label"})),this.canUnarchive()&&r()(a.Fragment,{},void 0,Ye,r()(De.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.unarchiveButton.label"}))))}renderAccessRequestedActions(e){const{rootStore:t}=this.props;if(!(e.edits||[])[0])return;const i=this.getRecordStore({table:b.J8,id:e.access_request_id});if(!i.isDefined())return;const o=i.getParentTable(),s=i.getParentId();switch(o){case A.iU:const e=Y.G.createChildStore(t,{table:o,id:s});if(!e.canAdmin())return;return r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(He,{accessRequestStore:i,targetBlockStore:e,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification}));case C.bx:const n=Y.H2.createChildStore(t,{table:o,id:s});return r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(Pe,{accessRequestStore:i,spaceStore:n,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification}));default:(0,I.t1)(o)}}renderNotificationActions(){if(this.canUnarchive())return r()("div",{style:Qe.actionContainerStyle},void 0,r()(De.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.actions.unarchiveButton.label"})));const e=this.getFollowStore();return null!=e&&e.isDefined()?e.getFollowing()?r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(De.Z,{onClick:this.handleUnfollow,style:this.getActionButtonStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"Unfollow this page",id:"activity.unfollowPageButton.label"}))):r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(De.Z,{onClick:this.handleFollow,style:this.getActionButtonStyle()},void 0,r()(x.FormattedMessage,{defaultMessage:"Re-follow this page",id:"activity.refollowPageButton.label"}))):void 0}renderUserInvitedActivity(e){if(!e.edits)return;let t,i,o;const s=this.getAuthors(e.edits),n=Oe(s),a=0===s.filter(l.uC).length,d=parseInt(e.end_time),h=e.edits[0];if(h.navigable_block_id){const l=this.getBlockStore(h.navigable_block_id);if(!l.isDefined())return;const u=this.renderTitle("block",l),p=(0,R.$e)(l.getModel(),e);if(p){const t=this.getRecordValue({table:M.Tu,id:p,spaceId:e.space_id});t&&t.message&&t.created_time<=d+5*P.hM&&(o={message:null==t?void 0:t.message,url:(0,c.Om)({table:A.iU,model:l.getModel(),getRecordModel:this.getRecordModel})})}i=r()(x.FormattedMessage,a?{defaultMessage:"You have been invited to {blockName}",values:{blockName:u},id:"activity.userInvitedActivityNavigableBlockByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {blockName}} other {{authorOrAuthors} invited you to {blockName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,blockName:u},id:"activity.userInvitedActivityNavigableBlock.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(l.id,"block")}else if(h.permission_group_id){const e=(0,m.Bg)({spaceId:h.space_id,permissionGroupId:h.permission_group_id,getRecordValue:this.getRecordValue}),o=this.renderPermissionGroupTitle(e,h.space_id);i=r()(x.FormattedMessage,a?{defaultMessage:"You have been added to group {groupName}",values:{groupName:o},id:"activity.userInvitedActivityGroupIdByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} added you to group {groupName}} other {{authorOrAuthors} added you to group {groupName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,groupName:o},id:"activity.userInvitedActivityGroupId.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}else{const e=this.getSpaceStore(h.space_id);if(!e)return;const o=this.renderTitle("space",e);i=r()(x.FormattedMessage,a?{defaultMessage:"You have been invited to {spaceName}",values:{spaceName:o},id:"activity.userInvitedActivityOtherInviteByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {spaceName}} other {{authorOrAuthors} invited you to {spaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,spaceName:o},id:"activity.userInvitedActivityOtherInvite.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}const u=a?void 0:r()(_e,{authors:s});return r()(Me,{timestamp:d,header:r()("span",{},void 0,i),isLast:this.props.isLast,isPrivate:t,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:u,showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,o&&r()(Fe.Z,{href:o.url,onClick:()=>this.track("click_user_invited"),innerStyle:this.getInviteMessageStyle()},void 0,o.message))}renderTeamMembershipEditedActivity(e){if(!e.edits)return;const t=this.getAuthors(e.edits),i=Oe(t),o=e.edits[0],s=this.getTeamStore(o.team_id);if(!s.isDefined())return;const n=this.renderTeamTitle("team",s),a=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to teamspace {teamName}} other {{authorOrAuthors} invited you to {teamName}}}",values:{numberOfAuthors:t.length,authorOrAuthors:i,teamName:n},id:"activity.userInvitedToTeamActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,a),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:t}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderPrivateContentTransferredActivity(e){if(!e.edits)return;const t=e.edits[0],i=t.from_user_id,o=this.getRecordValue({table:B.KJ,id:i});if(!o)return;const s=t.to_user_id;if(!this.getRecordValue({table:B.KJ,id:s}))return;const n=this.getBlockStore(e.navigable_block_id);if(!n.isDefined())return;const a=(0,l.$4)(z.default.getIntl(),{table:B.KJ,value:o}),d=this.getAuthors(e.edits),h=Oe(d),c=r()(x.FormattedMessage,{defaultMessage:"{authorPhrase} transferred private content from {fromUserName} to you: {pageName}",values:{authorPhrase:h,fromUserName:a,pageName:this.renderTitle("block",n)},id:"activity.privateContentTransferred.header",description:"Notification header for when private content is transferred from one user to another."});return r()(Me,{timestamp:parseInt(e.end_time),header:c,isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(n.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:d}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderCollectionEdited(e){if(!e.edits)return;const t=this.getRecordStore({table:y.v,id:e.collection_id,spaceId:e.space_id});if(!t.isDefined())return;const i=e.edits[0];if(!i)return;const o=(0,c.Om)({table:y.v,model:t.getModel(),getRecordModel:this.getRecordModel}),s=this.getAuthors(e.edits),n=Oe(s),a=this.renderTitle("collection",t),d="collection-created"===i.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {collectionTitle}} other {{authorOrAuthors} created {collectionTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,collectionTitle:a},id:"activity.collectionCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {collectionTitle}} other {{authorOrAuthors} edited {collectionTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:n,collectionTitle:a},id:"activity.collectionEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:s}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,h.OC(i)&&this.renderCollectionDescriptionEdit(i,o),this.renderNotificationActions())}renderCollectionDescriptionEdit(e,t){return r()(Fe.Z,{href:t,innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))}renderCollectionViewEdited(e){if(!e.edits)return;const t=this.getRecordStore({table:y.v,id:e.collection_id,spaceId:e.space_id});if(!t.isDefined())return;const i=this.getRecordStore({table:k.n,id:e.collection_view_id,spaceId:e.space_id});if(!i.isDefined())return;const o=(0,J.hI)(e.edits)[0];if(!o)return;const s=this.renderCollectionViewTitle(i),n=this.renderTitle("collection",t),a=this.getAuthors(e.edits),d=Oe(a);let h;return h="collection-view-created"===o.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:n,collectionViewTitle:s},id:"activity.collectionViewCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-view-deleted"===o.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:n,collectionViewTitle:s},id:"activity.collectionViewDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:n,collectionViewTitle:s},id:"activity.collectionViewEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:a}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderCollectionPropertyEdited(e){if(!e.edits)return;const t=(0,J.hI)(e.edits),i=t[0];if(!i)return;const o=this.getRecordStore({table:y.v,id:e.collection_id,spaceId:e.space_id});if(!o.isDefined())return;const s=(0,c.Om)({table:y.v,model:o.getModel(),getRecordModel:this.getRecordModel}),n="collection-property-changed"===i.type?i.collection_property_data.after:i.collection_property_data,a=this.getAuthors(e.edits),d=Oe(a),h=this.renderTitle("collection",o),l=this.renderCollectionPropertyTitle(n);let u;return u="collection-property-created"===i.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-property-deleted"===i.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,u),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(_e,{authors:a}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(je,{visible:5,items:t.map((e=>this.renderCollectionPropertyEdit(e,s)))}),this.renderNotificationActions())}renderReminderActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(t.navigable_block_id);if(!i.isDefined())return;const o=this.getBlockStore(e.reminder_block_id);if(!o.isDefined())return;const s=(0,c.Om)({table:"block",model:o.getModel(),getRecordModel:this.getRecordModel});return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"Reminder in {pageTitle}",id:"activity.reminderInActivity.header",values:{pageTitle:this.renderTitle("block",i)}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:s,onClick:()=>this.track("reminder_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderPageLockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(t.navigable_block_id);if(!i.isDefined())return;const o=this.getAuthors(e.edits),s=Oe(o),n=this.renderTitle("block",i),a="page-locked"===e.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} locked {blockTitle}} other {{authorOrAuthors} locked {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:n},id:"activity.pageLocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} unlocked {blockTitle}} other {{authorOrAuthors} unlocked {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:n},id:"activity.pageUnlocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,a),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(_e,{authors:o}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderEmailEdited(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getAuthors(e.edits),o=Oe(i);return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} changed email from {oldEmail} to {newEmail}} other {{authorOrAuthors} changed email from {oldEmail} to {newEmail}}}",values:{numberOfAuthors:i.length,authorOrAuthors:o,oldEmail:t.old_email,newEmail:t.new_email},id:"activity.emailEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:i}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderMembershipRequestHeader(e){if(!e.edits)return;const t=this.getRecordValue({table:b.J8,id:e.access_request_id});if(!t||t.for_actor_table!==B.KJ)return;const i=this.getRecordValue({table:t.for_actor_table,id:t.for_actor_id});if(!i)return;if(t.for_actor_id===t.created_by_id){const e=i.name?`${i.name} (${i.email})`:i.email;return r()(x.FormattedMessage,{defaultMessage:"{invitee} requested to become a workspace member",values:{invitee:r()("span",{style:{fontWeight:N.Z.fontWeight.semibold}},void 0,e)},id:"activity.accessRequestedMembershipFromGuest.header",description:"Notification header describing that a user created a membership request for themself."})}const o=this.getAuthors(e.edits),s=Oe(o);return r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} requested {invitee} to become a workspace member} other {{authorOrAuthors} requested {invitee} to become a workspace member}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,invitee:r()("span",{style:{fontWeight:N.Z.fontWeight.semibold}},void 0,i.email)},id:"activity.accessRequestedMembership.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}renderAccessRequestedHeader(e){if(!e.edits)return;if(!e.navigable_block_id)return;const t=this.getBlockStore(e.navigable_block_id);if(!t.isDefined())return;const i=this.getAuthors(e.edits),o=Oe(i);return r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} requested access to {pageName}} other {{authorOrAuthors} requested access to {pageName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:o,pageName:this.renderTitle(A.iU,t)},id:"activity.accessRequested.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}renderAccessRequested(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getRecordValue({table:b.J8,id:e.access_request_id});if(!i)return;if(i.parent_table===C.bx&&!(0,G.p1)())return;const o=i.parent_table===C.bx?this.renderMembershipRequestHeader(e):this.renderAccessRequestedHeader(e),{message:s}=t,n=this.getAuthors(e.edits),a=Oe(n);return r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,o),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(_e,{authors:n}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,s&&r()("div",{style:{paddingLeft:52,paddingRight:16,marginTop:8,marginBottom:8}},void 0,r()(Ie.Z,{isSmall:!0},void 0,r()(x.FormattedMessage,{id:"activity.accessRequested.messageLabel",defaultMessage:"Message from {author}",values:{author:a}})),r()(Ie.Z,{isMultiline:!0,style:{whiteSpace:"pre-wrap"}},void 0,s)),this.renderAccessRequestedActions(e),this.renderNotificationActions())}renderPageDeleteOrRestoreActivity(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getRecordStore({table:A.iU,id:t.navigable_block_id,spaceId:t.space_id});if(!i.isDefined())return;const o=this.getAuthors(e.edits),s=Oe(o),n=this.renderTitle(A.iU,i);let a;return"page-deleted"===e.type?a=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {blockTitle}} other {{authorOrAuthors} deleted {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:n},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-restored"===e.type?a=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored {blockTitle}} other {{authorOrAuthors} restored {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:n},id:"emailActivity.pageRestored.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-permanently-deleted"===e.type?a=r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} permanently deleted {blockTitle}} other {{authorOrAuthors} permanently deleted {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:n},id:"emailActivity.pagePermanentlyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):(0,I.t1)(e),r()(Me,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,a),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(_e,{authors:o}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderCollectionPropertyTitle(e){return r()("span",{style:{...Qe.boldStyle,whiteSpace:"nowrap"}},void 0,r()(g.ZP,{icon:e.icon,type:e.type,size:12,style:Qe.svgIconStyle,theme:this.theme}),e.name)}renderCollectionViewTitle(e){if(!e.isDefined())return;const t=(0,c.WE)({collectionView:e.getModel(),getRecordModel:this.getRecordModel});return r()(Fe.Z,{href:t,onClick:()=>this.track("click_title"),external:!1,innerStyle:{...Qe.pageLinkStyle,...Qe.boldStyle},inline:!0},void 0,r()(xe.F,{collectionViewStore:e,color:"light",style:{display:"inline-block",verticalAlign:"middle",marginRight:4,marginBottom:2},size:12}),r()(Ze.Z,{collectionViewName:e.getName(),collectionViewType:e.getType()}))}renderTitle(e,t){const i=t.getModel();if(!i)return;const o=(0,c.Al)({table:e,model:i,getRecordModel:this.getRecordModel}),s=(0,c.Om)({table:e,model:i,getRecordModel:this.getRecordModel});return r()(Fe.Z,{href:s,onClick:()=>this.track("click_title"),external:!1,innerStyle:Qe.pageLinkStyle,inline:!0},void 0,o&&a.createElement(a.Fragment,null,r()(Le.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{},void 0," ")),r()(qe.Z,{store:t,style:this.getActivityTitleStyle(void 0!==o)}))}renderTeamTitle(e,t){if(!t.isDefined())return;const i=(0,c.Al)({table:e,model:t.getModel(),getRecordModel:this.getRecordModel});return r()(Fe.Z,{onClick:e=>{this.track("click_user_invited_to_team"),(0,V.hI)({environment:this.environment,teamStore:t,shouldScroll:!0}),Q.Z.setState({...Q.Z.state,open:!1}),L.go(this.environment)},external:!1,innerStyle:Qe.pageLinkStyle,inline:!0},void 0,i&&a.createElement(a.Fragment,null,r()(Le.Z,{disabled:!0,icon:i,isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{},void 0," ")),r()(qe.Z,{store:t,style:this.getActivityTitleStyle(void 0!==i)}))}renderPermissionGroupTitle(e,t){let i,o;return e?(i=e.icon,o=e.name||r()(x.FormattedMessage,{defaultMessage:"Untitled group",id:"activity.permissionGroupTitles.untitledGroup"})):o=r()(x.FormattedMessage,{defaultMessage:"Deleted group",id:"activity.permissionGroupTitles.deletedGroup"}),r()("span",{},void 0,i&&r()(Le.Z,{disabled:!0,icon:{icon:i,pointer:{table:"space",id:t}},isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{style:this.getActivityTitleStyle(void 0!==i)},void 0,o))}renderPermissionGroupEditedHeader(e){const{activity:t,authors:i,groupName:o}=e,s=Oe(i),n=(0,J.hI)(t.edits||[])[0];return n?"permission-group-created"===n.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created group {groupName}} other {{authorOrAuthors} created group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-group-deleted"===n.type?r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted group {groupName}} other {{authorOrAuthors} deleted group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEditedDefault.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(x.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEdit.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}canUnarchive(){const{notification:e}=this.props;return!!e&&!!e.visited}getFollowStore(){if("following"!==X.Z.state.currentTab)return;const{notification:e}=this.props;if(!e)return;let t=e.navigable_block_id;if(!t){if(!e.collection_id)return;const i=this.getRecordStore({table:y.v,id:e.collection_id,spaceId:e.space_id});if(!i.isDefined())return;t=i.getParentId()}const i=this.environment.currentUser.id;if(!i)return;const o=(0,O.$j)({user_id:i,navigable_block_id:t});return this.getRecordStore({table:O.t0,id:o,spaceId:e.space_id})}handleFollowChanged(e){this.setFollowing(e),(0,F.XI)({newFollowState:e,...this.getBaseNotificationArgs()})}setFollowing(e){const t=this.getFollowStore();t&&E.createAndCommit({userAction:"Activity.setFollowing",environment:this.environment,perform:i=>{q.sW({store:t,transaction:i,data:{following:e}})}})}get getRecordValue(){return this.props.rootStore.getRecordValue}get getRecordModel(){return this.props.rootStore.getRecordModel}getBlockStore(e){return Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:e})}getAuthors(e){const t=n().uniqWith(n().flatten(e.map((e=>e.authors||[]))),n().isEqual);return n().compact(t.map(this.getAuthorActor))}handleTrackBacklinkClick(e){(0,F.EQ)({...this.getBaseNotificationArgs(),backlinkPageId:e})}handleTrackArchiveClicked(){(0,F._b)(this.getBaseNotificationArgs())}getBaseNotificationArgs(){const{notification:e,analyticsContext:t,activity:i}=this.props;return{environment:this.environment,activity:i,activityContext:t,notificationId:null==e?void 0:e.id}}track(e){var t;(0,F.pw)({environment:this.environment,target:e}),(0,Z.trackActivityAction)(this.environment,this.props.analyticsContext,{target:e,type:h.Fb(this.props.activity),activity_id:this.props.activity.id,notification_id:null===(t=this.props.notification)||void 0===t?void 0:t.id})}getIsRecordPrivateToUser(e,t){const{source:i}=this.props;if("notifications_tab_all"===i){if(!e)return!1;let i;return i="block"===t?Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:e}):"collection"===t?Y.NW.createChildStore(this.props.rootStore,{table:y.v,id:e}):Y.H2.createChildStore(this.props.rootStore,{table:C.bx,id:e}),(0,j.yi)(this.environment,i)}return!1}getActionButtonStyle(){return{boxShadow:this.theme.plainButtonBoxShadow,height:26,paddingLeft:8,paddingRight:8,fontWeight:500,color:this.theme.regularTextColor}}getActionSecondaryButtonStyle(){return{height:26,paddingLeft:8,paddingRight:8,color:this.theme.mediumTextColor}}getInviteMessageStyle(){return{paddingLeft:52,paddingTop:8,paddingBottom:8,paddingRight:12,fontSize:14}}getActivityTitleStyle(e){return{display:"inline",whiteSpace:"normal",marginRight:e?3:0,wordBreak:"break-word",...Qe.boldStyle}}}Qe.actionContainerStyle={paddingLeft:44,paddingTop:4},Qe.actionPrimaryContainerStyle={paddingLeft:52,paddingTop:12,paddingBottom:8},Qe.canSelectStyle={userSelect:"text",WebkitUserSelect:"text"},Qe.boldStyle={fontWeight:N.Z.fontWeight.semibold},Qe.pageLinkStyle={padding:1,...Qe.canSelectStyle},Qe.recordIconStyle={display:"inline-flex",marginRight:2,verticalAlign:"text-top"},Qe.svgIconStyle={width:12,height:12,display:"inline-block",verticalAlign:"middle",marginBottom:2,marginRight:4},Qe.editButtonStyle={padding:0,paddingLeft:52,paddingRight:16,...Qe.canSelectStyle};const Xe=Qe},98905:(e,t,i)=>{i.d(t,{Z:()=>s});var o=i(49085);class r extends o.Z{getInitialState(){return{count:0}}}const s=new r}}]);